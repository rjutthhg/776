<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Telegram Mini App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
      background: #f0f8ff;
    }
    #user-info {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 15px;
      border: 2px solid #0078d4;
      border-radius: 15px;
      background-color: #e1f0ff;
      font-weight: bold;
      display: none;
      user-select: none;
    }
    #warning {
      color: red;
      font-size: 18px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="user-info"></div>
  <div id="warning"></div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;

    function showUserInfo(fullName, username) {
      const infoBox = document.getElementById('user-info');
      infoBox.textContent = ${fullName} (@${username});
      infoBox.style.display = 'block';
    }

    // Проверяем, есть ли сохранённые данные
    const savedName = localStorage.getItem('tg_fullName');
    const savedUsername = localStorage.getItem('tg_username');

    if (savedName && savedUsername) {
      showUserInfo(savedName, savedUsername);
    }

    // Если открыто в Telegram и есть данные пользователя — сохраняем и показываем
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      const user = tg.initDataUnsafe.user;
      const fullName = user.first_name + (user.last_name ? ' ' + user.last_name : '');
      const username = user.username || 'без username';

      // Запоминаем в LocalStorage
      localStorage.setItem('tg_fullName', fullName);
      localStorage.setItem('tg_username', username);

      showUserInfo(fullName, username);
    } else if (!savedName || !savedUsername) {
      // Если нет данных и не в Telegram — предупреждаем
      document.getElementById('warning').textContent = 'Пожалуйста, откройте это приложение через Telegram';
    }
  </script>
</body>
</html>
