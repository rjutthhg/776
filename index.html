<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Мини-игра с джойстиком</title>
<style>
body, html {
margin: 0; padding: 0; overflow: hidden;
font-family: sans-serif;
background: #87ceeb;
user-select: none;
}
#joystick {
position: fixed;
bottom: 30px;
left: 30px;
width: 50px;
height: 50px;
background: rgba(0,0,0,0.3);
border-radius: 50%;
touch-action: none;
}
#stick {
position: absolute;
width: 30px;
height: 30px;
background: rgba(0,0,0,0.7);
border-radius: 50%;
left: 10px;
top: 10px;
}
#jumpBtn {
position: fixed;
right: 30px;
bottom: 30px;
width: 60px;
height: 60px;
background: orange;
border-radius: 50%;
font-weight: bold;
font-size: 18px;
color: white;
border: none;
user-select: none;
}
</style>
</head>
<body>

<div id="joystick">
<div id="stick"></div>
</div>
<button id="jumpBtn">Прыжок</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>

<script>
// Основные переменные для движения
let moveX = 0;
let moveZ = 0;
let velocityY = 0;
let isOnGround = true;

// Инициализация сцены Three.js
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 5, 10);

const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Платформа
const geometry = new THREE.BoxGeometry(20, 1, 20);
const material = new THREE.MeshStandardMaterial({color: 0x228B22});
const platform = new THREE.Mesh(geometry, material);
platform.position.y = -0.5;
scene.add(platform);

// Свет
const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
scene.add(ambientLight);
const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
directionalLight.position.set(5, 10, 7);
scene.add(directionalLight);

// Человечек из кубиков (просто один куб)
const humanGeometry = new THREE.BoxGeometry(1, 2, 1);
const humanMaterial = new THREE.MeshStandardMaterial({color: 0x0000ff});
const human = new THREE.Mesh(humanGeometry, humanMaterial);
human.position.y = 1; // чтобы стоял на платформе
scene.add(human);

// Джойстик
const joystick = document.getElementById('joystick');
const stick = document.getElementById('stick');

let originX = 25; // центр джойстика
let originY = 25;
let dragging = false;

joystick.addEventListener('pointerdown', (e) => {
dragging = true;
});

window.addEventListener('pointerup', (e) => {
dragging = false;
// Возвращаем стик в центр
stick.style.left = (originX - 15) + 'px';
stick.style.top = (originY - 15) + 'px';
moveX = 0;
moveZ = 0;
});

window.addEventListener('pointermove', (e) => {
if (!dragging) return;

const rect = joystick.getBoundingClientRect();
const dx = e.clientX - (rect.left + originX);
const dy = e.clientY - (rect.top + originY);

// Ограничиваем радиус джойстика (макс 40px)
const maxDist = 40;
const dist = Math.min(Math.sqrt(dx*dx + dy*dy), maxDist);
const angle = Math.atan2(dy, dx);

const stickX = originX + dist * Math.cos(angle);
const stickY = originY + dist * Math.sin(angle);
stick.style.left = `${stickX - 15}px`;
stick.style.top = `${stickY - 15}px`;

// Нормируем движение для управления
moveX = (dist / maxDist) * Math.cos(angle);
moveZ = (dist / maxDist) * Math.sin(angle);
});

// Кнопка прыжка
const jumpBtn = document.getElementById('jumpBtn');
jumpBtn.addEventListener('click', () => {
if (isOnGround) {
velocityY = 0.15;
isOnGround = false;
}
});

// Анимация
function animate() {
requestAnimationFrame(animate);

// Обновляем позицию по X и Z
human.position.x += moveX * 0.1;
human.position.z += moveZ * 0.1;

// Прыжок + гравитация
if (!isOnGround) {
velocityY -= 0.01;
human.position.y += velocityY;
if (human.position.y <= 1) {
human.position.y = 1;
velocityY = 0;
isOnGround = true;
}
}

// Камера следует за человечком (сзади и чуть сверху)
camera.position.x = human.position.x;
camera.position.z = human.position.z + 10;
camera.position.y = human.position.y + 5;
camera.lookAt(human.position);

renderer.render(scene, camera);
}

animate();

window.addEventListener('resize', () => {
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
